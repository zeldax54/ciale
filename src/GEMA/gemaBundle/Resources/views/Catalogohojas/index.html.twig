    {% extends 'gemaBundle::layout.html.twig' %}

    {% block gema_page -%}
     <style>



            table.sorting-table {cursor: move;}
            table tr.sorting-row td {background-color: #8b8;}
           .sorter {background-color: #c4ffe9; width: 10px; cursor: move;}

           .HideColHead,.HideCol{
               display:none;
           }
        </style>
    <h2>Listado de Catalogohojas</h2>
    {% if entities is empty %}
    <div class="bs-callout bs-callout-info">
        <i class="fa fa-info-circle img-responsive info_icon"></i>
        <h4>Aviso</h4>
        <p>No existen registros de activos en la base de datos.</p>
    </div>
    {% else %}

    <div class="table-responsive">
        <table class="record_properties table table-hover table table-striped table-vmiddle" id="data-table-command">
            <thead>
                <tr>  

                  <th data-formatter="sorteador" data-column-id="sorter"></th>       
                    <th data-column-id="id" data-type="numeric" data-identifier="true"  data-formatter="id" data-header-css-class="HideColHead" data-css-class="HideCol">Id</th>
                                                                   <th data-column-id="numero">Numero de hoja</th>
                                                                   <th data-column-id="catalogo" >Catalogo</th>
                                                                   <th data-column-id="tipo" >Tipo</th>
                                                                    <th data-column-id="foto" data-formatter="foto">Info</th>                     
                                                                     <th colspan="3" data-formatter="commands">Acciones</th>
                </tr>
            </thead>
            <tbody>
            {% for e in entities %}
                <tr>
                    <td class="sorter"></td>
                    <td>{{ e.id }} </td>                  
                    <td>{{ e.numero }} </td>
					{%if e.catalogo !=null%}
                    <td>{{ e.catalogo.titulo }} </td>
					{%else%}
					<td></td>
					{%endif%}
                    <td>{{ e.tipo }} </td>    
                        {% if e.tipo=="Imagen" %}            
                     <td>{{ asset(e.foto) }}</td>         
                     {% else %}
                       <td>{{ e.foto }}</td>    
                     {% endif %}   
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

     <!-- Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Eliminar Registro</h4>
                    </div>
                    <div class="modal-body">
                        ¿Está seguro que desea eliminar el registro definitivamente?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary eliminarRegistro">Aceptar</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->



            <ul class="pager">
            <li class="next"><a href="{{ path('catalogohojas_new') }}"><i class="fa fa-plus-circle"></i>
                    Nuevo Catalogohojas
                </a></li>
        </ul>
        {% endblock %}

    {% block javascripts -%}
    {{ parent() }}
    <script src="{{ asset('bundles/gema/js/rowsorter.js') }}"></script>
        <script src="{{ asset('bundles/gema/js/TableToJson/jquery.tabletojson.js') }}"></script>
    <script>
         $("#data-table-command").bootgrid({
             rowSelect:true,
            css: {
                icon: 'md icon',
                iconColumns: 'md-view-module',
                iconDown: 'md-expand-more',
                iconRefresh: 'md-refresh',
                iconUp: 'md-expand-less'
            },
            formatters: {

                "id":function(column, row) {
                    return row.id;
                },         

                "sorteador":function(column, row) {
                    return '<span class="sorterhh"></span>';
                },         

                 "foto": function(column, row) {                    
                     if(row.tipo.trim().localeCompare("Imagen")===0)
                       return '<img width="70px" height="70px" src="'+row.foto+'">';
                    return row.foto;
                },      

                "commands": function(column, row) {
                    return "<a href='" + Routing.generate('catalogohojas_edit', {id: row.id}) + "'  class=\"btn btn-icon command-edit\" ><span class=\"md md-edit\"></span></a> " +
                            "<a href='" + Routing.generate('catalogohojas_delete', {id: row.id}) + "' data-id=\'" + row.id + "\' class=\"btn btn-icon command-delete\" ><span class=\"md md-delete\"></span></a>";
                },
               "catalogo": function(column, row) {               
                    return "" + row.catalogo.titulo;
                },
            }, templates: {
                loading: "<tr><td colspan='9' class=\"loading\"><div class='loading'><img src='{{ asset('bundles/gema/images/loading.gif') }}' class='img-responsive'></div></td></tr>"
            }
        }).on("loaded.rs.jquery.bootgrid", function (e)
        {

            $(".command-delete").on('click', function (evt) {
                evt.preventDefault();
                url = Routing.generate('catalogohojas_delete', {id: $(this).data('id')});
                $("#deleteModal").modal("show");
            });

            $(".eliminarRegistro").on("click", function (evt) {
                window.location = url;
            });   
             $('.sorterhh').each(function(){
                $(this).closest('td').addClass('sorter');
            })        
        });
    </script>


     <script>
            $(document).ready(function(){
                new RowSorter('#data-table-command',{

                            onDrop: function(tbody, row, new_index, old_index) {   

                                 var table = tbody.tagName === "TBODY" ? tbody.parentNode : tbody;
                                 var arr = $('#data-table-command').tableToJSON({ignoreHiddenRows: false});                           
                                var arrfin=[];
                               for(var i=0;i<arr.length;i++)
                                   arrfin.push([i+1,arr[i].Id]);                               
                               console.log(arrfin);
                                $.ajax({
                                    url: Routing.generate('gema_reorderhojas'),
                                    type: 'POST',
                                    data: { ordered:arrfin },
                                    success: function(result) {
                                         for(var i=0;i<arr.length;i++){
                                             $('#data-table-command').find('tr').eq(i+1).find('td').eq(2).html(i+1);

                                         }                                        
                                        console.log(result);
                                    },
                                    error:function(){
                                        $.rowSorter.undo('#'+table.id);
                                    }
                                });                             

                            }

                        }
                );
            });
        </script>
    {% endblock %}

