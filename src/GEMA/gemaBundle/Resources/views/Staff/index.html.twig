    {% extends 'gemaBundle::layout.html.twig' %}



    {% block gema_page -%}

        <style>



            table.sorting-table {cursor: move;}
            table tr.sorting-row td {background-color: #8b8;}
           .sorter {background-color: #c4ffe9; width: 10px; cursor: move;}
        </style>

        {% if isvendedor==0 %}
            <h2>Miembros del Staff</h2>

    {% else %}
        <h2>Red de ventas en {{ provincianame }}</h2>

    {% endif %}

<div style="width: 200px;text-align: center;margin: 0 auto">
        <h4>Seleccionar provincia</h4>
        <select id="provinciasselect" class="tag-select">
        {% for p in provincias %}
            {% if p.id==proseleccionada %}
            <option value="{{ p.id }}" selected>{{ p.nombre }}</option>
            {% else %}
                <option value="{{ p.id }}">{{ p.nombre }}</option>
            {% endif %}
    {% endfor %}
            </select>
</div>
    {% if entities is empty %}
    <div class="bs-callout bs-callout-info">
        <i class="fa fa-info-circle img-responsive info_icon"></i>
        <h4>Aviso</h4>
        <p>No existen registros de activos en la base de datos.</p>
    </div>
    {% else %}

        <ul class="pager">

            {% if isvendedor==0 %}
            <li class="next"><a href="{{ path('admin_staff_new') }}"><i class="fa fa-user"></i>
                    Nuevo miembro del Staff
                </a></li>
                <li class="next"><a href="{{ path('admin_distribuidor') }}"><i class="glyphicon glyphicon-globe"></i>
                        Distribuidores Internacionales
                    </a></li>
                <li class="next"><a href="{{ path('admin_datosoficina_edit',{'id':1}) }}"><i class="zmdi zmdi-email"></i>
                        Datos de Oficina e Email
                    </a></li>
            {% else %}
                <li class="next"><a href="{{ path('admin_distribuidorlocal_new') }}"><i class="fa fa-user"></i>
                        Nuevo Distribuidor
                    </a></li>
                <li class="next"><a href="{{ path('admin_vendedor_new') }}"><i class="fa fa-user"></i>
                        Nuevo vendedor
                    </a></li>

            {% endif %}

        </ul>
    <div class="table-responsive">
        <table class="record_properties table table-hover table table-striped table-vmiddle" id="data-table-command" >
            <thead>
                <tr>
                    <th data-formatter="sorteador"></th>
                    <th data-column-id="id" data-type="numeric" data-identifier="true" data-visible="false">ID</th>
                    <th  data-formatter="foto" data-column-id="foto">Foto</th>
                    {% if isvendedor==0 %}
                    <th data-column-id="cargo">Cargo</th>
                    {% endif %}
                                                                    <th data-column-id="nombre">Nombre</th>
                                                                    <th data-column-id="telefono">Telefono</th>
                                                                    <th data-column-id="email">Email</th>

                    <th colspan="3" data-formatter="commands">Acciones</th>
                </tr>
            </thead>
            <tbody>
            {% for e in entities %}
                <tr>
                    <td class="sorter"></td>
                    <td>{{ e.id }} </td>
                    <td>{{ asset(e.foto) }}</td>
                    {% if isvendedor==0 %}
                    <td>{{ e.cargo }} </td>
                    {% endif %}
                    <td>{{ e.nombre }} </td>
                    <td>{{ e.telefono }} </td>
                    <td>{{ e.email }} </td>

                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

        {% if isvendedor==1 and distribuidores|length>0 %}
            <h4>Distribuidores</h4>
    <table class="record_properties table table-hover table table-striped table-vmiddle" id="data-table-command2" >
        <thead>
         <tr>
             <th data-column-id="id" data-type="numeric" data-identifier="true" data-visible="false">ID</th>
             <th data-column-id="ciudad" >Localidad</th>
             <th data-column-id="nombreveterinaria" >Veterinaria</th>
             <th colspan="3" data-formatter="commands">Acciones</th>
         </tr>
        </thead>

    <tbody>
    {% for d in distribuidores %}
        <tr>
            <td>{{ d.id }}</td>
            <td>{{ d.ciudad }}</td>
            <td>{{ d.nombreveterinaria }}</td>
        </tr>
    {% endfor %}
    </tbody>
    </table>
        {% endif %}

        <!-- Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Eliminar Registro</h4>
                    </div>
                    <div class="modal-body">
                        ¿Está seguro que desea eliminar el registro definitivamente?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary eliminarRegistro">Aceptar</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
    {% if isvendedor==0 %}
            <ul class="pager">
            <li class="next"><a href="{{ path('admin_staff_new') }}"><i class="fa fa-plus-circle"></i>
                    Nuevo miembro del Staff
                </a></li>
        </ul>
    {% endif %}
        {% endblock %}

    {% block javascripts -%}
    {{ parent() }}

        <script src="{{ asset('bundles/gema/js/rowsorter.js') }}"></script>
        <script src="{{ asset('bundles/gema/js/TableToJson/jquery.tabletojson.js') }}"></script>
    <script>
        var param='{{ param }}';
        $("#data-table-command").bootgrid({
            css: {
                icon: 'md icon',
                iconColumns: 'md-view-module',
                iconDown: 'md-expand-more',
                iconRefresh: 'md-refresh',
                iconUp: 'md-expand-less'
            },
            formatters: {
                "commands": function(column, row) {
                    return "<a href='" + Routing.generate('admin_'+ param +'_edit', {id: row.id}) + "'  class=\"btn btn-icon command-edit\" ><span class=\"md md-edit\"></span></a> " +
                            "<a href='" + Routing.generate('admin_'+param+'_delete', {id: row.id}) +  "' data-id=\'" + row.id +"'  class=\"btn btn-icon command-delete\" ><span class=\"md md-delete\"></span></a>";
                },
                "foto": function(column, row) {
                    return '<img width="70px" height="70px" src="'+row.foto+'">';
                }
                ,"sorteador":function(column, row) {
                    return '<span class="sorterhh"></span>';
                }






            }, templates: {
                loading: "<tr><td colspan='9' class=\"loading\"><div class='loading'><img src='{{ asset('bundles/gema/images/loading.gif') }}' class='img-responsive'></div></td></tr>"
            }
        }).on("loaded.rs.jquery.bootgrid", function (e)
        {
            $(".command-delete").on('click', function (evt) {
                evt.preventDefault();
                url = Routing.generate('admin_'+param+'_delete', {id: $(this).data('id')});
                $("#deleteModal").modal("show");
            });

            $(".eliminarRegistro").on("click", function (evt) {
                window.location = url;
            });

            $('.sorterhh').each(function(){
                $(this).closest('td').addClass('sorter');
            })


        });


        $("#data-table-command2").bootgrid({
            css: {
                icon: 'md icon',
                iconColumns: 'md-view-module',
                iconDown: 'md-expand-more',
                iconRefresh: 'md-refresh',
                iconUp: 'md-expand-less'
            },
            formatters: {
                "commands": function(column, row) {
                    return "<a href='" + Routing.generate('admin_distribuidorlocal_edit', {id: row.id}) + "'  class=\"btn btn-icon command-edit\" ><span class=\"md md-edit\"></span></a> " +
                            "<a href='" + Routing.generate('admin_distribuidorlocal_delete', {id: row.id}) +  "' data-id=\'" + row.id + "'  class=\"btn btn-icon command-delete\" ><span class=\"md md-delete\"></span></a>";
                }


            }, templates: {
                loading: "<tr><td colspan='9' class=\"loading\"><div class='loading'><img src='{{ asset('bundles/gema/images/loading.gif') }}' class='img-responsive'></div></td></tr>"
            }
        }).on("loaded.rs.jquery.bootgrid", function (e)
        {
            $(".command-delete").on('click', function (evt) {
                evt.preventDefault();
                url = Routing.generate('admin_distribuidorlocal_delete', {id: $(this).data('id')});
                $("#deleteModal").modal("show");
            });

            $(".eliminarRegistro").on("click", function (evt) {
                window.location = url;
            });


        });


    </script>

        <script>
            $('#provinciasselect').change(function(){
                var url = Routing.generate('gema_mixed',{idprovincia:$(this).val()});
                window.location=url;

            });
        </script>

        <script>
            $(document).ready(function(){
                new RowSorter('#data-table-command',{

                            onDrop: function(tbody, row, new_index, old_index) {
                                var donde='{{ param }}';
                                var provinciaid='{{proseleccionada}}';
                                var table = tbody.tagName === "TBODY" ? tbody.parentNode : tbody;


                                var arr = $('#'+table.id).tableToJSON({ignoreHiddenRows: false});
                                var arrfin=[];
                               for(var i=0;i<arr.length;i++){
                                   arrfin.push([i,arr[i].Nombre]);

                               }
                                $.ajax({
                                    url: Routing.generate('gema_reorder'),
                                    type: 'POST',
                                    data: { value: arrfin,donde:donde,provinciaid:provinciaid },
                                    success: function(result) {

                                    },
                                    error:function(){
                                        $.rowSorter.undo('#'+table.id);
                                    }
                                });

                            }

                        }


                );
            });
        </script>
    {% endblock %}

